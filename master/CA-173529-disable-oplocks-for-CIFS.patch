From 06e28a1904893b97c9572889073b1670826f528b Mon Sep 17 00:00:00 2001
From: Chandrika Srinivasan <chandrika.srinivasan@citrix.com>
Date: Wed, 29 Jul 2015 09:42:52 +0000
Subject: [PATCH] CA-173529: Turn off oplocks to disable client side-caching

Oplocks interfere with concurrent access of CIFS files by multiple
clients and hence need to be disabled for CIFS shares to serve as 
a shared SR in a XenServer Pool. 

This is hopefully a temporary patch till we can figure out a more
elegant way to disable oplocks through an external interface. 

Signed-off-by: Chandrika Srinivasan <chandrika.srinivasan@citrix.com>
diff --git a/fs/cifs/cifsfs.c b/fs/cifs/cifsfs.c
index 0917f80..167e464 100644
--- a/fs/cifs/cifsfs.c
+++ b/fs/cifs/cifsfs.c
@@ -55,7 +55,7 @@
 
 int cifsFYI = 0;
 int traceSMB = 0;
-bool enable_oplocks = true;
+bool enable_oplocks = false;
 unsigned int linuxExtEnabled = 1;
 unsigned int lookupCacheEnabled = 1;
 unsigned int global_secflags = CIFSSEC_DEF;
